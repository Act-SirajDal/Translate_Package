import json
import datetime
import os
import pymysql

config_file: str = "C:/project_files/travel_project/expedia/project_configs.json"

if os.path.exists(config_file):
    with open(config_file, 'r') as config:
        configs: dict = json.load(config)
else:
    project_config_path: str = "/".join(config_file.split('/')[:-1])
    os.makedirs(project_config_path)

client = pymysql.connect(host=configs['config']['host'],
                         user=configs['config']['user'],
                         password=configs['config']['password'],
                         database=configs['config']['database'])
cursor = client.cursor()

today_date = datetime.datetime.today().strftime('%Y_%m_%d')
daily_link_table = configs['tables']['link_table'] + '_' + today_date
create_table = f"""
CREATE TABLE IF NOT EXISTS {daily_link_table} (
id INT PRIMARY KEY AUTO_INCREMENT,
url TEXT,
hotel_id VARCHAR(25),
hotel_url VARCHAR(255),
hotel_name VARCHAR(255),
hotel_address VARCHAR(1000),
checkin_date VARCHAR(10),
checkout_date VARCHAR(10),
currency VARCHAR(3),
page_hash VARCHAR(255),
status VARCHAR(20) DEFAULT 'Pending'
);"""
try:
    cursor.execute(create_table)
    client.commit()
except Exception as e:
    print(e)

fetch_query = f"""SELECT id, hotel_id, hotel_url, hotel_name, hotel_address, currency FROM {daily_link_table}"""
cursor.execute(fetch_query)
fetched_urls = cursor.fetchall()
print(len(fetched_urls), "Fetched URLs")
if len(fetched_urls) == 0:
    # fetch_query = f"""SELECT id, hotel_id, hotel_url, hotel_name, hotel_address, currency FROM {configs['tables']['link_table']}"""
    fetch_query = f"""SELECT id, hotel_id, hotel_url, hotel_name, hotel_address, currency FROM {configs['tables']['link_table']}"""
    cursor.execute(fetch_query)
    fetched_urls = cursor.fetchall()
    print(len(fetched_urls), "Fetched URLs")

    for url_id, hotel_id, hotel_url, hotel_name, hotel_address, currency in fetched_urls:
        today_date = datetime.datetime.today()

        for day in range(1, 31):
            checkout_date = today_date + datetime.timedelta(day)
            formatted_checkout_date = checkout_date.strftime('%Y-%m-%d')

            checkin_date = checkout_date - datetime.timedelta(1)
            formatted_checkin_date = checkin_date.strftime('%Y-%m-%d')

            url = None
            if 'MXN' == currency:
                currency = 'MXN'
                site_id = 12
                url = f"https://www.expedia.com/graphql?operationName=androidPropertyOffersPropertyInfo&variables=%7B%22context%22%3A%7B%22clientInfo%22%3A%7B%22name%22%3A%22android.com.expedia.bookings%22%2C%22version%22%3A%222024.18.0%22%7D%2C%22currency%22%3A%22{currency}%22%2C%22debugContext%22%3A%7B%22abacusOverrides%22%3A%5B%7B%22bucket%22%3A1%2C%22id%22%3A%2225805%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2231491%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2231619%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2233771%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2229000%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2243695%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2245649%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2244371%22%7D%5D%7D%2C%22device%22%3A%7B%22type%22%3A%22APP_PHONE%22%7D%2C%22identity%22%3A%7B%22authState%22%3A%22AUTHENTICATED%22%2C%22duaid%22%3A%227fea7240-2109-4b81-aec5-589451d8e19e%22%2C%22expUserId%22%3A%22903111441%22%2C%22tuid%22%3A%221717678609%22%7D%2C%22locale%22%3A%22en_US%22%2C%22privacyTrackingState%22%3A%22CAN_TRACK%22%2C%22siteId%22%3A{site_id}%7D%2C%22marketing%22%3A%7B%7D%2C%22propertyId%22%3A%22{hotel_id}%22%2C%22searchCriteria%22%3A%7B%22primary%22%3A%7B%22dateRange%22%3A%7B%22checkInDate%22%3A%7B%22day%22%3A{int(checkin_date.strftime('%d'))}%2C%22month%22%3A{int(checkin_date.strftime('%m'))}%2C%22year%22%3A{int(checkin_date.strftime('%Y'))}%7D%2C%22checkOutDate%22%3A%7B%22day%22%3A{int(checkout_date.strftime('%d'))}%2C%22month%22%3A{int(checkout_date.strftime('%m'))}%2C%22year%22%3A{int(checkout_date.strftime('%Y'))}%7D%7D%2C%22destination%22%3A%7B%22coordinates%22%3A%7B%22latitude%22%3A19.432%2C%22longitude%22%3A-99.1344%7D%2C%22propertyIds%22%3Anull%2C%22regionId%22%3A%22178285%22%7D%2C%22flexSearchCriteria%22%3A%7B%22flexibility%22%3A%5B%7B%22length%22%3A0%2C%22unit%22%3A%22DAY%22%7D%5D%7D%2C%22rooms%22%3A%5B%7B%22adults%22%3A2%2C%22children%22%3A%5B%5D%7D%5D%7D%2C%22secondary%22%3A%7B%22ranges%22%3A%5B%5D%2C%22selections%22%3A%5B%7B%22id%22%3A%22sort%22%2C%22value%22%3A%22RECOMMENDED%22%7D%2C%7B%22id%22%3A%22privacyTrackingState%22%2C%22value%22%3A%22CAN_NOT_TRACK%22%7D%2C%7B%22id%22%3A%22searchId%22%2C%22value%22%3A%225e8a07ab-b15f-46df-aa10-8cb16f20a0c5%22%7D%2C%7B%22id%22%3A%22theme%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22userIntent%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22hotelName%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22useRewards%22%2C%22value%22%3A%22SHOP_WITH_POINTS%22%7D%5D%7D%7D%2C%22travelAdTrackingInfo%22%3A%7B%22beaconIssued%22%3A%22%22%2C%22position%22%3A%222%22%2C%22rank%22%3A%222%22%2C%22slots%22%3A%22%22%2C%22testVersionOverride%22%3A%22Buttercup%2C39483.0.0%2C50206.169039.1%2C50028.0.0%2C50813.0.0%2C49817.165296.0%2C51642.169494.0%2C49460.169941.1%2C51690.172858.1%2C52131.163559.0%2C52527.0.0%2C52789.175840.0%2C53217.0.0%2C49375.0.0%2C50573.165353.1%2C54072.177389.1%22%2C%22trackingData%22%3A%22AAAAAQAAAAEAAAAQkhD9b04K5PWvIxs5JeuptJ9M7bREE-Q9EIEhp4gjEVnN-Es9Lv2b5aoguwV36vqSGFagqDYRyR4bh2qLQ6yvXr-Q0vIFbN03KGQ8iUQSaMYNcGpQ6H0sB4-fBjTDYzKlqeIXbt_q407OJd_qwDATFyJdQaLY3IMhq6woUCsReDmaV5guGX_wp7yl0QegeQiciCnj7DzQBSmEBlKwNiW4cTQ-n8eXNZqKuSCZdX7NawQVjUJ9o_5lg-QwjdAWHeena_tlkoc5q4p8l4qfn0N7eAgrboFJas9BShHLSnQHXh9E3jmhOg_9TePf-Mg0W9xvsWXxBzLjs09Mb9oft8G8DoQxnC_vxH_URX-EP8ndQJHlCVL6FOkKXwbhp7WXF8KQ-r3UHxHJQt0-MUZHFOGFCp5NaI526sF1Ja9iBJz3poVkSyHjOnX5xzFx9hQaungpukMZ7P5KtDUMFOVpNRLTTh3ZJVWYvoX-ZK5Xd2NFmmh4BZ8VE12PwYlKixMP1ELtOGFSRKhTKkiOk7CU55FwOWVxuZ6BEV6auNhwbbxTcAgrSCCwK6CZVR791m_-bVvsG_pEAWWwFg1U9Sa7d1LAuy27z21zgk8_VFmCm_VarSNBITiFAMeozfLD5bLBR54CDsDSdJrMzBNCKwEa81IWKjwTgLMb02daJfKmIozqCKxwtSypjWoHf3dJz4V_mDn1h-ub5P4CMl75F8XgGFrEFPYIiy2cMC041WLXdMfBHtjs7Ap4YpD5ZUzNDvYf22QS2zAxSjCC3X2vJyAT6lhdzisLKIQMD6DGzBBKBYn4xZKcxMUPDk7qjXCveXLQqATI6F5Zis7GgYKKGGeFpTr4wHgO2NoWsNyhA9N16je53C2rjjnpBvjQKoNyarlWGybPHpinQ1k5BwCQ09mefSNZ9dpFsZw2csaGK1Sf46sIrq_Revw22rlcLjn-XyW3WJGvFKRCyeGmdlnziMn4thPr7Ob3HGqzlCkza_qF7_9Ea-f8e01pAjDaftlcNzSZ1SqETb34g0Puwe9mzUqxOf658oxEBiaRXsQQyx_kl8-GMmrNw_bukBGdx2FWuWC5TBs2IHY7m_qrP27veujPmjcFzx3JN1IV9uynTMmCenTosbwAI3toFjTG6XZN95SwdZjyPLGh1UTVdXh8Kx_R5mEN26_W7wCbR3B33Q8zzrI-9RAmRdVkxiAHUDFTsFbLMXG8AmQhdRgEsdqGEESTgW1RiKSnnu4OAQeanM6PwcSLAz_Mpapa14y59YCPgPgu4PRBOOjJfMg-7EO7StAdikVmh_Bql1RW3sK8mLvz2oY8RNGQNPlaML2ql9YpB6_NPmVKUBlJQfIulANaTnpOCMSkm396X9dBIec70hhSctuyEXtHnvpWCjhKkkWnTrshW0nldEAiiHgXV3FK-N5ETwDSAUGdSStLU9gcbtCOT9xyJl_mfXucYh4gTobljmSd6CSevGKnP1k-ZYORox1OVFATj6O4-B1dm1w0iXMvydHkLB9K82Lr2E2ujqAcSEjhSBStBARlNbE8vAJ9GiiXyLYoJf8Kazo1JTNZAL3RTKtoDyj5Djgm21c-WoheDYi4_2X4PlBlu6HlwfpaYqD7tqUR_ZLrfJQMjXFLHE5zh1z03TS0biHErrMUY2PpRc73hYqiAER_9xKbUlJRwXaxx4e4RfFs9EuAr-OqHUVdV-x4X7SSDW3FRWYKPji9b9ASDX19pca-pEW7lr2WKf6_1z1oX89m7Ism9qiirrUDHHEdV9973bmpTbLTxsJN73EW8GIdoKEBFtdLuGKuNKKKR4sp1jBdW-GhmDw7kzlMuMFeJXdBa2F2b4oub4uMjYflzKGYj9BVymDikY3kEe8kYl28bNl5pT1G8xSv1oKxJzghoQ4M7zLnF8o_UO6oawoLhNAmTcjdW9AyboIxnVrpDlTMQwNXzLQn_0XYAtIh3-cBynzS-vP9MqmPuWbjoOlJs2NRO6qF6__bG5M2EqgHiV3EcdsSGMDBxFdk3vNzsoT7Z1XAMpiOD9YXrjxR_n77h42cww7UpOSgndzAIB7U4iDueDuFNT5UlfWovWt926LTWyw5lkyf43e80kTSKYOCfkG567N_LQsghObdruob1F8rEpj-0XDcmArN6y8Pf5WRMryNcrzeNq9I15mtLVmG-bfO33lzVT-rUsZkOydNMEgTyRDJVzXXWrHv_gS_KBMhrvwl-mZ4OkSo8XLBGLy6u9Pr31QjZNOnLXj16bxxkxCw9o1Ah0YQdyP91Mg95F7VYFGSKMbEYO03e6ctYOSFLbNW75sEJxTIWS7vuc8GPeWr5UYhIFlju3XbZVQKzYF14WMnzOgDLRGI77wsaUeHoPvcWCDbL_gZFCsaX86xliHq2d9vba28u1vNvYAC3s87KTYjetEmyjGWH1bd2lbvU0j-hqkagooqN7tlw0RqLx7iUFTdh4ezVbzRwT5LU1mZrdk%3D%22%7D%2C%22includeCategorizedListings%22%3Atrue%2C%22includeLodgingOffersPriceDetails%22%3Atrue%2C%22includeFallback%22%3Atrue%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%227f109796d8b5458603eb4b0fbf3a7b273759be45600a86fbea86eada19a73f07%22%7D%7D"
            if 'BRL' == currency:
                currency = 'BRL'
                site_id = 69
                # url = f"https://www.expedia.com/graphql?operationName=androidPropertyOffersPropertyInfo&variables=%7B%22context%22%3A%7B%22clientInfo%22%3A%7B%22name%22%3A%22android.com.expedia.bookings%22%2C%22version%22%3A%222024.18.0%22%7D%2C%22currency%22%3A%22{currency}%22%2C%22debugContext%22%3A%7B%22abacusOverrides%22%3A%5B%7B%22bucket%22%3A1%2C%22id%22%3A%2225805%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2231491%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2231619%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2233771%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2229000%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2243695%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2245649%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2244371%22%7D%5D%7D%2C%22device%22%3A%7B%22type%22%3A%22APP_PHONE%22%7D%2C%22identity%22%3A%7B%22authState%22%3A%22AUTHENTICATED%22%2C%22duaid%22%3A%227fea7240-2109-4b81-aec5-589451d8e19e%22%2C%22expUserId%22%3A%22903111441%22%2C%22tuid%22%3A%221717678609%22%7D%2C%22locale%22%3A%22en_US%22%2C%22privacyTrackingState%22%3A%22CAN_TRACK%22%2C%22siteId%22%3A{site_id}%7D%2C%22marketing%22%3A%7B%7D%2C%22propertyId%22%3A%22{hotel_id}%22%2C%22searchCriteria%22%3A%7B%22primary%22%3A%7B%22dateRange%22%3A%7B%22checkInDate%22%3A%7B%22day%22%3A{int(checkin_date.strftime('%d'))}%2C%22month%22%3A{int(checkin_date.strftime('%m'))}%2C%22year%22%3A{int(checkin_date.strftime('%Y'))}%7D%2C%22checkOutDate%22%3A%7B%22day%22%3A{int(checkout_date.strftime('%d'))}%2C%22month%22%3A{int(checkout_date.strftime('%m'))}%2C%22year%22%3A{int(checkout_date.strftime('%Y'))}%7D%7D%2C%22destination%22%3A%7B%22coordinates%22%3A%7B%22latitude%22%3A19.432%2C%22longitude%22%3A-99.1344%7D%2C%22propertyIds%22%3Anull%2C%22regionId%22%3A%22178285%22%7D%2C%22flexSearchCriteria%22%3A%7B%22flexibility%22%3A%5B%7B%22length%22%3A0%2C%22unit%22%3A%22DAY%22%7D%5D%7D%2C%22rooms%22%3A%5B%7B%22adults%22%3A2%2C%22children%22%3A%5B%5D%7D%5D%7D%2C%22secondary%22%3A%7B%22ranges%22%3A%5B%5D%2C%22selections%22%3A%5B%7B%22id%22%3A%22sort%22%2C%22value%22%3A%22RECOMMENDED%22%7D%2C%7B%22id%22%3A%22privacyTrackingState%22%2C%22value%22%3A%22CAN_NOT_TRACK%22%7D%2C%7B%22id%22%3A%22searchId%22%2C%22value%22%3A%225e8a07ab-b15f-46df-aa10-8cb16f20a0c5%22%7D%2C%7B%22id%22%3A%22theme%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22userIntent%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22hotelName%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22useRewards%22%2C%22value%22%3A%22SHOP_WITH_POINTS%22%7D%5D%7D%7D%2C%22travelAdTrackingInfo%22%3A%7B%22beaconIssued%22%3A%22%22%2C%22position%22%3A%222%22%2C%22rank%22%3A%222%22%2C%22slots%22%3A%22%22%2C%22testVersionOverride%22%3A%22Buttercup%2C39483.0.0%2C50206.169039.1%2C50028.0.0%2C50813.0.0%2C49817.165296.0%2C51642.169494.0%2C49460.169941.1%2C51690.172858.1%2C52131.163559.0%2C52527.0.0%2C52789.175840.0%2C53217.0.0%2C49375.0.0%2C50573.165353.1%2C54072.177389.1%22%2C%22trackingData%22%3A%22AAAAAQAAAAEAAAAQkhD9b04K5PWvIxs5JeuptJ9M7bREE-Q9EIEhp4gjEVnN-Es9Lv2b5aoguwV36vqSGFagqDYRyR4bh2qLQ6yvXr-Q0vIFbN03KGQ8iUQSaMYNcGpQ6H0sB4-fBjTDYzKlqeIXbt_q407OJd_qwDATFyJdQaLY3IMhq6woUCsReDmaV5guGX_wp7yl0QegeQiciCnj7DzQBSmEBlKwNiW4cTQ-n8eXNZqKuSCZdX7NawQVjUJ9o_5lg-QwjdAWHeena_tlkoc5q4p8l4qfn0N7eAgrboFJas9BShHLSnQHXh9E3jmhOg_9TePf-Mg0W9xvsWXxBzLjs09Mb9oft8G8DoQxnC_vxH_URX-EP8ndQJHlCVL6FOkKXwbhp7WXF8KQ-r3UHxHJQt0-MUZHFOGFCp5NaI526sF1Ja9iBJz3poVkSyHjOnX5xzFx9hQaungpukMZ7P5KtDUMFOVpNRLTTh3ZJVWYvoX-ZK5Xd2NFmmh4BZ8VE12PwYlKixMP1ELtOGFSRKhTKkiOk7CU55FwOWVxuZ6BEV6auNhwbbxTcAgrSCCwK6CZVR791m_-bVvsG_pEAWWwFg1U9Sa7d1LAuy27z21zgk8_VFmCm_VarSNBITiFAMeozfLD5bLBR54CDsDSdJrMzBNCKwEa81IWKjwTgLMb02daJfKmIozqCKxwtSypjWoHf3dJz4V_mDn1h-ub5P4CMl75F8XgGFrEFPYIiy2cMC041WLXdMfBHtjs7Ap4YpD5ZUzNDvYf22QS2zAxSjCC3X2vJyAT6lhdzisLKIQMD6DGzBBKBYn4xZKcxMUPDk7qjXCveXLQqATI6F5Zis7GgYKKGGeFpTr4wHgO2NoWsNyhA9N16je53C2rjjnpBvjQKoNyarlWGybPHpinQ1k5BwCQ09mefSNZ9dpFsZw2csaGK1Sf46sIrq_Revw22rlcLjn-XyW3WJGvFKRCyeGmdlnziMn4thPr7Ob3HGqzlCkza_qF7_9Ea-f8e01pAjDaftlcNzSZ1SqETb34g0Puwe9mzUqxOf658oxEBiaRXsQQyx_kl8-GMmrNw_bukBGdx2FWuWC5TBs2IHY7m_qrP27veujPmjcFzx3JN1IV9uynTMmCenTosbwAI3toFjTG6XZN95SwdZjyPLGh1UTVdXh8Kx_R5mEN26_W7wCbR3B33Q8zzrI-9RAmRdVkxiAHUDFTsFbLMXG8AmQhdRgEsdqGEESTgW1RiKSnnu4OAQeanM6PwcSLAz_Mpapa14y59YCPgPgu4PRBOOjJfMg-7EO7StAdikVmh_Bql1RW3sK8mLvz2oY8RNGQNPlaML2ql9YpB6_NPmVKUBlJQfIulANaTnpOCMSkm396X9dBIec70hhSctuyEXtHnvpWCjhKkkWnTrshW0nldEAiiHgXV3FK-N5ETwDSAUGdSStLU9gcbtCOT9xyJl_mfXucYh4gTobljmSd6CSevGKnP1k-ZYORox1OVFATj6O4-B1dm1w0iXMvydHkLB9K82Lr2E2ujqAcSEjhSBStBARlNbE8vAJ9GiiXyLYoJf8Kazo1JTNZAL3RTKtoDyj5Djgm21c-WoheDYi4_2X4PlBlu6HlwfpaYqD7tqUR_ZLrfJQMjXFLHE5zh1z03TS0biHErrMUY2PpRc73hYqiAER_9xKbUlJRwXaxx4e4RfFs9EuAr-OqHUVdV-x4X7SSDW3FRWYKPji9b9ASDX19pca-pEW7lr2WKf6_1z1oX89m7Ism9qiirrUDHHEdV9973bmpTbLTxsJN73EW8GIdoKEBFtdLuGKuNKKKR4sp1jBdW-GhmDw7kzlMuMFeJXdBa2F2b4oub4uMjYflzKGYj9BVymDikY3kEe8kYl28bNl5pT1G8xSv1oKxJzghoQ4M7zLnF8o_UO6oawoLhNAmTcjdW9AyboIxnVrpDlTMQwNXzLQn_0XYAtIh3-cBynzS-vP9MqmPuWbjoOlJs2NRO6qF6__bG5M2EqgHiV3EcdsSGMDBxFdk3vNzsoT7Z1XAMpiOD9YXrjxR_n77h42cww7UpOSgndzAIB7U4iDueDuFNT5UlfWovWt926LTWyw5lkyf43e80kTSKYOCfkG567N_LQsghObdruob1F8rEpj-0XDcmArN6y8Pf5WRMryNcrzeNq9I15mtLVmG-bfO33lzVT-rUsZkOydNMEgTyRDJVzXXWrHv_gS_KBMhrvwl-mZ4OkSo8XLBGLy6u9Pr31QjZNOnLXj16bxxkxCw9o1Ah0YQdyP91Mg95F7VYFGSKMbEYO03e6ctYOSFLbNW75sEJxTIWS7vuc8GPeWr5UYhIFlju3XbZVQKzYF14WMnzOgDLRGI77wsaUeHoPvcWCDbL_gZFCsaX86xliHq2d9vba28u1vNvYAC3s87KTYjetEmyjGWH1bd2lbvU0j-hqkagooqN7tlw0RqLx7iUFTdh4ezVbzRwT5LU1mZrdk%3D%22%7D%2C%22includeCategorizedListings%22%3Atrue%2C%22includeLodgingOffersPriceDetails%22%3Atrue%2C%22includeFallback%22%3Atrue%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%227f109796d8b5458603eb4b0fbf3a7b273759be45600a86fbea86eada19a73f07%22%7D%7D"
                url = f"https://www.expedia.com.br/graphql?operationName=androidPropertyOffersPropertyInfo&variables=%7B%22context%22%3A%7B%22clientInfo%22%3A%7B%22name%22%3A%22android.com.expedia.bookings%22%2C%22version%22%3A%222024.18.0%22%7D%2C%22currency%22%3A%22{currency}%22%2C%22debugContext%22%3A%7B%22abacusOverrides%22%3A%5B%7B%22bucket%22%3A1%2C%22id%22%3A%2225805%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2231491%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2231619%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2233771%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2229000%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2243695%22%7D%2C%7B%22bucket%22%3A1%2C%22id%22%3A%2244371%22%7D%5D%7D%2C%22device%22%3A%7B%22type%22%3A%22APP_PHONE%22%7D%2C%22identity%22%3A%7B%22authState%22%3A%22AUTHENTICATED%22%2C%22duaid%22%3A%227fea7240-2109-4b81-aec5-589451d8e19e%22%2C%22expUserId%22%3A%22903111441%22%2C%22tuid%22%3A%22737467733%22%7D%2C%22locale%22%3A%22en_US%22%2C%22privacyTrackingState%22%3A%22CAN_TRACK%22%2C%22siteId%22%3A{site_id}%7D%2C%22marketing%22%3A%7B%7D%2C%22propertyId%22%3A%22{hotel_id}%22%2C%22searchCriteria%22%3A%7B%22primary%22%3A%7B%22dateRange%22%3A%7B%22checkInDate%22%3A%7B%22day%22%3A{int(checkin_date.strftime('%d'))}%2C%22month%22%3A{int(checkin_date.strftime('%m'))}%2C%22year%22%3A{int(checkin_date.strftime('%Y'))}%7D%2C%22checkOutDate%22%3A%7B%22day%22%3A{int(checkout_date.strftime('%d'))}%2C%22month%22%3A{int(checkout_date.strftime('%m'))}%2C%22year%22%3A{int(checkout_date.strftime('%Y'))}%7D%7D%2C%22destination%22%3A%7B%22coordinates%22%3A%7B%22latitude%22%3A-23.553848%2C%22longitude%22%3A-47.091647%7D%2C%22pinnedPropertyId%22%3A%2285452989%22%2C%22propertyIds%22%3Anull%2C%22regionId%22%3A%226142437%22%2C%22regionName%22%3A%22OYO%20Pousada%20e%20Hotel%20Putini%22%7D%2C%22flexSearchCriteria%22%3A%7B%22flexibility%22%3A%5B%7B%22length%22%3A0%2C%22unit%22%3A%22DAY%22%7D%5D%7D%2C%22rooms%22%3A%5B%7B%22adults%22%3A2%2C%22children%22%3A%5B%5D%7D%5D%7D%2C%22secondary%22%3A%7B%22ranges%22%3A%5B%5D%2C%22selections%22%3A%5B%7B%22id%22%3A%22sort%22%2C%22value%22%3A%22RECOMMENDED%22%7D%2C%7B%22id%22%3A%22privacyTrackingState%22%2C%22value%22%3A%22CAN_NOT_TRACK%22%7D%2C%7B%22id%22%3A%22searchId%22%2C%22value%22%3A%2276ac3d73-744b-4449-a93a-dccff2520932%22%7D%2C%7B%22id%22%3A%22theme%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22userIntent%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22hotelName%22%2C%22value%22%3A%22%22%7D%2C%7B%22id%22%3A%22useRewards%22%2C%22value%22%3A%22SHOP_WITHOUT_POINTS%22%7D%5D%7D%7D%2C%22includeCategorizedListings%22%3Atrue%2C%22includeLodgingOffersPriceDetails%22%3Atrue%2C%22includeFallback%22%3Atrue%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%227f109796d8b5458603eb4b0fbf3a7b273759be45600a86fbea86eada19a73f07%22%7D%7D"
            insert = f"""INSERT INTO {daily_link_table} (url, hotel_id, hotel_url, hotel_name, hotel_address, currency, checkin_date, checkout_date) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)"""
            cursor.execute(insert, (url, hotel_id, hotel_url, hotel_name, hotel_address, currency, formatted_checkin_date, formatted_checkout_date))
            client.commit()

    print(len(fetched_urls), "Daily Link Generate Process Done....")
else:
    print(len(fetched_urls), "Daily Link Generate Table Already Exits....")